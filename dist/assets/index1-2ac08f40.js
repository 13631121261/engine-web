import{l as L,h as O,a as U}from"./map-a5492c66.js";import{s as N,i as z,d as K,a as Q}from"./map_addfence1-8a32682b.js";import{c as X,_ as Y}from"./index-1515df1a.js";import{F as Z}from"./index-a773531e.js";import{m as $,p as j,k as J,q as W,s as D}from"./index-24a0fd9a.js";import{I as aa}from"./gateway-d31fe4cf.js";import ea from"./PopAreaName-04a53575.js";import{h as ta,w as k,r as oa,F as na,q as C,o as la,k as da,m as c,p,z as s,Q as x,Z as V,V as G,t as sa,K as ra,a0 as ia,a1 as ma}from"./vue-974988d6.js";import"./sass.default-e4c9116c.js";import"./moment-fbc5633a.js";import"./index-11ae6512.js";import"./index-7182f49c.js";const pa=f=>(ia("data-v-97d89144"),f=f(),ma(),f),ca=pa(()=>c("div",{id:"main",class:"hdmrboxtm-mbox",viewBox:"0 0 0 0"},null,-1)),_a={class:"dataCount"},ga={style:{"margin-top":"20px","margin-left":"10px","margin-right":"10px"}},ua={style:{height:"40px",float:"right"}},fa=ta({__name:"index1",setup(f){const{t:i}=X();k("");let n=[],l={};var P,A,I,S,h;let y=oa([]),w=k(0);na(()=>{setTimeout(function(){$().then(t=>{t.data.length>0&&g(t.data[0])})},1e3)});const R=t=>{console.log(t),W(t).then(a=>{console.log(a),g(h),a.code==-10&&ra({message:i("delete_area_tip"),type:"error",duration:3e3,dangerouslyUseHTMLString:!0})})};function F(){return window.innerHeight-250}const g=t=>{h=t,n=[],w.value=0,y.splice(0,y.length),N(),clearInterval(P),A=t.proportion,L(t.data),z(M,t.data),I=t.map_key,S=t.name,j(t.map_key).then(a=>{if(w.value=1,a.data.length>0){console.log(w);for(var e=0;e<a.data.length;e++){O(a.data[e].point,a.data[e].name,a.data[e].x,a.data[e].y,M,a.data[e].id,1);const o={id:a.data[e].id,name:a.data[e].name,x:a.data[e].x,y:a.data[e].y,data:"",point:a.data[e].point,gateway_mac:a.data[e].gateway_mac,map_key:a.data[e].may_key,map_name:a.data[e].map_name};console.log("aaaa"+o),console.log(o),y.push(o)}}J(t.map_key).then(o=>{if(console.log("厕所"),console.log(o.data),o.data.length>0)for(var d=0;d<o.data.length;d++){const r={address:o.data[d].address,name:o.data[d].name,x:o.data[d].x,y:o.data[d].y,proportion:A,show:!1,online:0,last_time:o.data[d].last_time,type:2};n.push(r),U(r)}}).finally(()=>{})}).finally(()=>{})};let _=k(!1);var u=0;function H(t,a){_.value=!1;for(var e=0;e<n.length;e++)n[e].show=!1;console.log("回调="+a+u+t),l.name=a,l.id=u,t=="submit"?(console.log("回调="+a+u+t),D(l).then(o=>{console.log(o),g(h)})):g(h)}function T(t){var a=5.5,e=0;for(let o=0;o<t.length;o++)a=a+t[o].x/1,e=e+t[o].y/1;return[a/t.length,e/t.length]}function M(t,a,e,o,d,r,B){console.log(e);var v="";d=="add"?(console.log("新增区域"),console.log("回调划线="+e),K(),N()):d=="edit"&&console.log("编辑区域");for(var m=0;m<n.length;m++){var E=aa(n[m].x,n[m].y,e,n[m].proportion);E&&(n[m].show=!0,v=v+n[m].address+","+n[m].type+"-",console.log("有网关符合区域="+v))}l.map_name=S,l.map_key=I,l.name=B,l.data=o,l.point=t,l.gateway_mac=v;var b=T(e);l.x=b[0],l.y=b[1],console.log("网关在   "+b[0]),_.value=!0,u=r}function q(){console.log("创建"),Q()}return(t,a)=>{const e=C("el-button"),o=C("el-table-column"),d=C("el-table");return la(),da("div",null,[ca,c("div",_a,[c("div",null,[c("div",null,[c("div",ga,[p(Z,{label:s(i)("file"),type:"remoteSelect","input-attr":{multiple:!1,pk:"id",field:"name","remote-url":"/userApi/map/index2?aa="+Math.random(),onRow:g},placeholder:s(i)("file")},null,8,["label","input-attr","placeholder"])])])]),c("div",null,[c("div",ua,[p(e,{style:{"margin-right":"20px"},type:"primary",onClick:a[0]||(a[0]=r=>q())},{default:x(()=>[V(G(s(i)("Add")),1)]),_:1})]),c("div",null,[p(d,{data:s(y),height:F()},{default:x(()=>[p(o,{prop:"name",label:s(i)("area_name"),align:t.center},null,8,["label","align"]),p(o,{prop:"map_name",label:s(i)("map_name")},null,8,["label"]),p(o,{label:s(i)("Operate"),"header-align":t.center,width:90},{default:x(r=>[p(e,{style:{"margin-right":"0","margin-left":"0"},type:"danger",onClick:B=>R(r.row.id)},{default:x(()=>[V(G(s(i)("Delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label","header-align"])]),_:1},8,["data","height"])])])]),p(ea,{show:s(_),"onUpdate:show":a[1]||(a[1]=r=>sa(_)?_.value=r:_=r),gateways:s(n),area_name:s(l).name,id:s(u),onGetChange:H},null,8,["show","gateways","area_name","id"])])}}});const Ba=Y(fa,[["__scopeId","data-v-97d89144"]]);export{Ba as default};
