import{h as le,w as S,ar as re,r as me,q as f,a8 as h,o as u,P as V,Q as s,a9 as I,k as A,Z as k,V as U,z as t,m as g,l as ne,p as i,$ as ie,a7 as P,K as C,a0 as se,a1 as de}from"./vue-974988d6.js";import{a as pe,c as fe,_ as ue}from"./index-1515df1a.js";import{b as c}from"./validate-8bf15b2e.js";import{F as y}from"./index-a773531e.js";import{l as T,i as ce,j as _e}from"./map-a5492c66.js";import{i as E,c as ye}from"./map_addfence1-8a32682b.js";import{t as ge,p as M}from"./index-24a0fd9a.js";import{I as be}from"./gateway-d31fe4cf.js";import"./index-11ae6512.js";import"./index-7182f49c.js";import"./sass.default-e4c9116c.js";import"./moment-fbc5633a.js";const N=b=>(se("data-v-4b34ce4a"),b=b(),de(),b),ve={class:"title"},he={key:0},Ve=N(()=>g("span",null,"-",-1)),ke=N(()=>g("div",{id:"main",class:"hdmrboxtm-mbox",viewBox:"0 0 0 0"},null,-1)),xe=le({__name:"popupForm",emits:["get-change"],setup(b,{emit:R}){pe();const x=S(),e=re("baTable"),{t:l}=fe(),z=me({name:[c({name:"required",title:l("fence_name")})],fence_type:[c({name:"required",title:l("fence_type")})],timeout:[c({name:"required",title:l("fence_time")})],fence_time_type:[c({name:"required",title:l("fence_time_type")})],start_time:[c({name:"required",title:l("start_time")})],stop_time:[c({name:"required",title:l("stop_time")})]}),K=(a,o)=>(e.form.items.start_times=a+":"+o,B(1,59)),L=(a,o)=>(e.form.items.stop_times=a+":"+o,B(1,59)),B=(a,o)=>{const r=[];for(let m=a;m<=o;m++)r.push(m);return r};function $(){if(v=0,e.form.items.time_type==2&&(e.form.items.start_time==null||e.form.items.stop_time==null)){C({title:"",message:"需要填写时间",position:"top-right",type:"error",duration:3e3,dangerouslyUseHTMLString:!0});return}if(e.form.items.area_id==0){C({title:"",message:"需要选择对应区域",position:"top-right",type:"error",duration:3e3,dangerouslyUseHTMLString:!0});return}if(e.form.items.timeout<3){C({title:"",message:"停留次数触发不少于3次",position:"top-right",type:"error",duration:3e3,dangerouslyUseHTMLString:!0});return}e.onSubmit(x.value)}function H(){return e.form.items.time_type!=1}var v=0;const O=()=>{console.log("打开"),e.form.items.name==null?(e.form.items.time_type=1,e.form.items.area_id=0,e.form.items.timeout=10):["Edit"].includes(e.form.operate)&&v==0&&(v=1,ge(e.form.items.map_key).then(a=>{T(a.data.data),E(F,a.data.data),M(e.form.items.map_key).then(o=>{if(o.data.length>0)for(var r=0;r<o.data.length;r++)ce(o.data[r].point,o.data[r].name,o.data[r].x,o.data[r].y,o.data[r].id,e.form.items.area_id)}).finally(()=>{})}))};let d=[],j=S(!1);S("");const D=a=>{if(["Edit"].includes(e.form.operate)&&(ye(),e.form.items.point="",e.form.items.gateway_mac="",d!=null&&d.length>0))for(var o=0;o<d.length;o++)d[o].show=!1;console.log(a),e.form.items.map_key=a.map_key,e.form.items.map_name=a.name,T(a.data),E(F,a.data),M(a.map_key).then(r=>{if(r.data.length>0)for(var m=0;m<r.data.length;m++)_e(r.data[m].point,r.data[m].name,r.data[m].x,r.data[m].y,G,r.data[m].id)}).finally(()=>{})};function G(a,o){e.form.items.area_id=a,e.form.items.area_name=o}const W=a=>{v=0,console.log("关闭之前"),Q("cancel")};function Q(a){R("get-change",a)}function X(){return!!["Edit"].includes(e.form.operate)}function Y(a){var o=5.5,r=0;for(let m=0;m<a.length;m++)o=o+a[m].x/1,r=r+a[m].y/1;return[o/a.length,r/a.length]}function F(a,o,r){console.log("回调划线="+o),e.form.items.data=r,e.form.items.point=a;for(var m="",p=0;p<d.length;p++){var w=be(d[p].x,d[p].y,o,d[p].proportion);w&&(d[p].show=!0,m=m+d[p].address+",")}var _=Y(o);console.log("网关在   "+_[0]),e.form.items.x=_[0],e.form.items.y=_[1],e.form.items.gateway_mac=m,j.value=!0}return(a,o)=>{const r=f("el-input"),m=f("el-form-item"),p=f("el-time-picker"),w=f("el-row"),_=f("el-form"),Z=f("el-scrollbar"),q=f("el-button"),J=f("el-drawer"),ee=h("drag"),te=h("zoom"),oe=h("loading"),ae=h("blur");return u(),V(J,{class:"ba-operate-dialog","close-on-click-modal":!0,"model-value":["Add","Edit"].includes(t(e).form.operate),"destroy-on-close":!0,title:t(l)("map.list.look"),direction:"rtl",size:"80%",open:O(),"before-close":W},{header:s(()=>[I((u(),A("div",ve,[k(U(t(e).form.operate?t(l)(t(e).form.operate):""),1)])),[[ee,[".ba-operate-dialog",".el-dialog__header"]],[te,".ba-operate-dialog"]])]),footer:s(()=>[g("div",{style:ne("width: calc(100% - "+t(e).form.labelWidth/1.8+"px)")},[i(q,{onClick:o[9]||(o[9]=n=>t(e).toggleForm(""))},{default:s(()=>[k(U(t(l)("Cancel")),1)]),_:1}),I((u(),V(q,{loading:t(e).form.submitLoading,onClick:o[10]||(o[10]=n=>$()),type:"primary"},{default:s(()=>[k(U(t(e).form.operateIds&&t(e).form.operateIds.length>1?t(l)("Save and edit next item"):t(l)("Save")),1)]),_:1},8,["loading"])),[[ae]])],4)]),default:s(()=>[I((u(),V(Z,{class:"ba-table-form-scrollbar"},{default:s(()=>[g("div",null,[t(e).form.loading?P("",!0):(u(),V(_,{key:0,ref_key:"formRef",ref:x,onKeyup:o[8]||(o[8]=ie(n=>t(e).onSubmit(x.value),["enter"])),model:t(e).form.items,"label-position":"right","label-width":t(e).form.labelWidth+"px",rules:z},{default:s(()=>[i(y,{"input-attr":{clearable:!0},label:t(l)("fence_name"),modelValue:t(e).form.items.name,"onUpdate:modelValue":o[0]||(o[0]=n=>t(e).form.items.name=n),type:"string",prop:"name",width:"60px",placeholder:t(l)("Please input field",{field:t(l)("fence_name")})},null,8,["label","modelValue","placeholder"]),i(m,{label:t(l)("fence_time"),style:{width:"30%"},prop:"timeout"},{default:s(()=>[i(r,{modelValue:t(e).form.items.timeout,"onUpdate:modelValue":o[1]||(o[1]=n=>t(e).form.items.timeout=n),placeholder:t(l)("fence_time")},{append:s(()=>[k("次")]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),i(y,{label:t(l)("fence_type"),type:"select",prop:"fence_type",modelValue:t(e).form.items.fence_type,"onUpdate:modelValue":o[2]||(o[2]=n=>t(e).form.items.fence_type=n),data:{content:{ON:t(l)("fence_on"),OUT:t(l)("fence_out")}}},null,8,["label","modelValue","data"]),i(y,{label:t(l)("fence_status"),type:"switch",modelValue:t(e).form.items.open_status,"onUpdate:modelValue":o[3]||(o[3]=n=>t(e).form.items.open_status=n)},null,8,["label","modelValue"]),g("div",null,[i(y,{label:t(l)("fence_time_type"),type:"radio",modelValue:t(e).form.items.time_type,"onUpdate:modelValue":o[4]||(o[4]=n=>t(e).form.items.time_type=n),data:{childrenAttr:{border:!0},content:{1:t(l)("fence_time_type_24"),2:t(l)("fence_time_type_cus")}}},null,8,["label","modelValue","data"]),H()?(u(),A("div",he,[i(w,null,{default:s(()=>[i(m,{label:t(l)("fence_time_type")},{default:s(()=>[i(p,{"disabled-seconds":K,prop:"start_time",placeholder:t(l)("fence_starttime"),modelValue:t(e).form.items.start_time,"onUpdate:modelValue":o[5]||(o[5]=n=>t(e).form.items.start_time=n)},null,8,["placeholder","modelValue"]),Ve]),_:1},8,["label"]),i(m,{style:{"margin-left":"0px"}},{default:s(()=>[i(p,{style:{"margin-left":"-160px"},placeholder:t(l)("fence_stoptime"),"disabled-seconds":L,modelValue:t(e).form.items.stop_time,"onUpdate:modelValue":o[6]||(o[6]=n=>t(e).form.items.stop_time=n)},null,8,["placeholder","modelValue"])]),_:1})]),_:1})])):P("",!0)]),i(y,{prop:"map_name",label:t(l)("file"),type:"remoteSelect",modelValue:t(e).form.items.map_name,"onUpdate:modelValue":o[7]||(o[7]=n=>t(e).form.items.map_name=n),"input-attr":{disabled:X(),multiple:!1,pk:"id",field:"name","remote-url":"/userApi/map/index2?aa="+Math.random(),onRow:D},placeholder:t(l)("file")},null,8,["label","modelValue","input-attr","placeholder"])]),_:1},8,["model","label-width","rules"]))]),ke]),_:1})),[[oe,t(e).form.loading]])]),_:1},8,["model-value","title","open"])}}});const Me=ue(xe,[["__scopeId","data-v-4b34ce4a"]]);export{Me as default};
