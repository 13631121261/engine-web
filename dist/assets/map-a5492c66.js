import{t as J,$ as w,S as Q}from"./sass.default-e4c9116c.js";import{h as R}from"./moment-fbc5633a.js";import{i as y}from"./index-1515df1a.js";import{K as $}from"./vue-974988d6.js";J.Color;var h=20,oo="",u,A,D,c=5,W=new Map,N=new Map,O=new Map;function fo(o){W.clear(),O.clear();var e=w("#main"),t,l;if(e.offsetWidth==null||e.offsetHeight==null||e.offsetWidth==0||e.offsetHeight==0?(t=e.height(),l=e.width(),console.log("111实际宽高="+t+"  "+l)):(t=e.offsetHeight,l=e.offsetWidth,console.log("222实际宽高="+t+"  "+l)),console.log("实际宽高="+t+"  "+l),o!=null){o=o.replace(/\r|\n|\t/g,"");var a=o.split(/<svg.*?>/),s=/(width=)/,n=/(height=)/,f=o.split(s),_=o.split(n);A=f[2].split(/(\d*\.?\d*)/)[1],D=_[2].split(/(\d*\.?\d*)/)[1],console.log("宽=="+A+"  高="+D);var g=w("#main")[0];A/D>l/t?h=l/A:h=t/D,console.log(e),g.innerHTML="",console.log(g),g.innerHTML='<svg id="svgmain" style="width:'+l+"px;height:"+t+'px" viewBox="0 0 '+l+" "+t+'"><filter id="grayscale"><feColorMatrix type="matrix" values="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"/></filter><g id="svgPanel"  >'+a[1]+"</g></svg>";var v=(l-A*h)/2,m=(t-D*h)/2;if(console.log("scale="+v+" m="+m),h<=0)h=1;else{var F="translate("+v+","+m+")  scale("+h+")";svgPanel.setAttribute("transform",F)}console.log("imgWidth = "+c),console.log("scale = "+h),c=A*.00625,console.log("imgWidth = "+c),u=Q("#svgPanel"),console.log("执行创建画布"+u),q(),eo()}}function eo(){w("#svgmain").on("mousewheel DOMMouseScroll",function(o){o.preventDefault();var e=o.originalEvent.wheelDelta&&(o.originalEvent.wheelDelta>0?1:-1)||o.originalEvent.detail&&(o.originalEvent.detail>0?-1:1);to(o,e)})}function to(o,e){e>0?Z(o,1.05):Z(o,.95)}function Z(o,e){h*=e;var t=document.getElementById("svgPanel"),l=t.getAttribute("transform");l=l.match(/translate\([^)]+\)/),h>100?h=100:h<.1&&(h=.1);var a=l[0]+" scale("+h+")";t.setAttribute("transform",a)}var k=!0;function q(){w("#main").mousedown(function(o){console.log("移动触发"),this.setCapture&&this.setCapture(),k=!0;var e=o.pageX-w("#svgPanel").offset().left,t=o.pageY-w("#svgPanel").offset().top;w("#main").mousemove(function(l){if(k){var a=document.getElementById("svgPanel"),s=a.getAttribute("transform"),n=s.indexOf(",");n==-1&&(n=s.indexOf(" "));var f=s.substring(s.indexOf("(")+1,n),_=s.substring(n+1,s.indexOf(")")),g=w("#svgPanel").offset().left-parseInt(f),v=w("#svgPanel").offset().top-parseInt(_);w("#svgPanel"),l.pageX-e,l.pageY-t;var m="translate("+(Math.floor((l.pageX-e)*100)/100-g)+","+(Math.floor((l.pageY-t)*100)/100-v)+")  scale("+h+")";a.setAttribute("transform",m)}}),w("#main").mouseup(function(){k=!1,console.log("map2")})})}function uo(o){if(console.log("开始添加"+o.address),u!=null){console.log(u);var e=u.group().addClass("my-group2");console.log("宽高="+c);var t;(o.type==1||o.type==2)&&(o.online==1?(console.log("网关在线"),t=e.image("/src/assets/gateway_online.png")):(console.log("网关离线"),t=e.image("/src/assets/gateway.png"))),t.size(c,c),e.move(o.x*o.proportion,o.y*o.proportion),console.log("666=="+o.x),console.log("666=="+o.y),console.log("666=="+c/2),console.log(o.address+"  X="+o.x*o.proportion),console.log("网关在线"+o.address+"  Y="+(o.y*o.proportion-c/2)),e.data("data",{value:o}),e.click(function(l){var a=this.data("data").value;console.log(a);var s,n;a.online==1?(s="success",n="<span>"+y.global.t("gateway_name")+"："+a.name+"<br/>"+y.global.t("aoa_mac")+"：<span>"+a.address+"</span><br/>"+y.global.t("x")+":"+a.x+"<br/>"+y.global.t("y")+":"+a.y+"<br/>"+y.global.t("last time")+":"+X(a.last_time)):(s="error",n="<span>"+y.global.t("gateway_name")+"："+a.name+"<br/>"+y.global.t("aoa_mac")+"：<span>"+a.address+"</span><br/>"+y.global.t("x")+":"+a.x+"<br/>"+y.global.t("y")+":"+a.y+"<br/>"+y.global.t("last time")+":"+X(a.last_time)),$({message:n,type:s,duration:5e3,dangerouslyUseHTMLString:!0})}),console.log("添加完成"),W.set(o.address,e)}}function X(o){return o==null?"":R(o*1e3).format("YYYY-MM-DD HH:mm:ss")}function vo(o){if(u!=null){var e=W.get(o.address);if(e!=null){if(e.data("data",{value:o}),o.show)e.show();else{e.hide();return}var t;o.online!=e.data().data.value.online&&(e.clear(),o.online==1?(t=e.image("/src/assets/gateway_online.png"),t.size(5,5),t.move(o.x*o.proportion-c/2,o.y*o.proportion-c/2)):(t=e.image("/src/assets/gateway.png"),t.size(5,5),t.move(o.x*o.proportion-c/2,o.y*o.proportion-c/2)))}}}function go(o){if(u!=null){var e=O.get(o.address);if(e==null){e=u.group().addClass("my-group3");var t=e.image("/src/assets/aoa_on.png");t.size(c,c),t.animate().move(o.x*o.proportion,o.y*o.proportion),e.data("data",{value:o}),e.click(function(l){var a=this.data("data").value;console.log(a);var s;s="<span>"+y.global.t("tag_address")+":"+a.address+"<br/>"+y.global.t("x")+":"+a.x+"<br/>"+y.global.t("y")+":"+a.y+"<br/>"+y.global.t("last time")+":"+X(a.last_time)+"</span>",$({message:s,type:"success",duration:3e3,dangerouslyUseHTMLString:!0})})}else{if(o.show==!1){e.hide();return}else e.show();e.data("data",{value:o}),e.animate(1e3).move(o.x*o.proportion,o.y*o.proportion)}O.set(o.address,e)}}function co(o){var e=W.get(o);console.log("执行动画"),e.animate({duration:100,delay:10,when:"now",swing:!0,times:4}).attr({fill:"#f03"}).size(c*1.5,c*1.5)}function mo(o){var e=O.get(o);console.log("执行动画"),e.animate({duration:100,delay:10,when:"now",swing:!0,times:4}).attr({fill:"#f03"}).size(c*1.5,c*1.5)}var I=[],z,ao=["#3399ff","#33ffff","#33ff99","#97b651","#5500FF","#FF99CC"];function po(o,e,t,l,a,s,n){console.log("创建"+s),z=u.group();var f=z.polygon(o);f.opacity(.5);var _=s%5;f.fill(ao[_]);var g=z.text(e);if(g.move(t-10,l-5).font({fill:"#000",family:"Inconsolata",size:2.5}),g.data("data",{name:e,id:s}),f.data("data",{name:e,id:s,status:0}),n==1){var v=z.polyline(o),m={};m.color="#f00",m.width=.3,v.fill("none"),v.stroke(m),f.dblclick(function(F){var M=this,b=this.data("data"),P=b.status;console.log("区域双击"+P);var i=this.plot();if(P==0){P=1,console.log("点位="+i.length),i.splice(i.length-1,1);for(var r=0;r<i.length-1;r++)r!=i.length-1&&i[r][0]==i[r+1][0]&&i[r][1]==i[r+1][1]&&i.splice(r,1);if(console.log("最后点位="+i.length),I.length>0){for(var r=0;r<i.length;r++)pointmarkerp[r]!=null&&I[r].remove();I=[]}for(var r=0;r<i.length;r++)if(!(r!=i.length-1&&i[r][0]==i[r+1][0]&&i[r][1]==i[r+1][1])){var B=u.circle(2).fill("#0af").move(i[r][0]-1,i[r][1]-1);B.data("data",{move:!0,index:r}),I[r]=B,B.mousedown(function(no){var j=this,K=this.data("data");this.data("data",{move:!0,index:K.index}),console.log("按下"),u.mousemove(function(U){if(k=!1,console.log("标点移动"),H=j.data("data"),k=!1,H.move){var G=C(U.offsetX,U.offsetY,0);j.move(G.x,G.y),i[H.index][0]=G.x+3,i[H.index][1]=G.y+3,v.remove(),v=z.polyline(i.toString()+","+i[0]);var H={};H.color="#f00",H.width=.3,v.fill("none"),v.stroke(H),console.log("index="+i.toString()),console.log("index="+i.toString()),M.plot(i)}}),this.mouseup(function(U){console.log("抬起"),k=!0,this.data("data",{move:!1,index:K.index}),u.mousemove(null),q()}),console.log(B)})}i.push(i[0])}else if(P==1){if(I.length>0){for(var r=0;r<I.length;r++)I[r]!=null&&I[r].remove();I=[]}P=0;for(var L=[],r=0;r<i.length;r++)L.push(new V(i[r][0],i[r][1]));a(i.toString(),L,L,oo,"edit",s,e)}b.status=b,this.data("data",{status:P,name:b.name,id:b.id})})}}var T,d,S=[],x;function ho(o,e,t,l,a,s){T==null&&(T=u.group()),console.log("X1="+e),console.log("Y1="+t),console.log("X2="+l),console.log("Y2="+a);var n=e,f=t,_=l,g=a,v=u.line(n,f,f,g);v.plot(n,f,n,f),v.mouseover(function(m){var F=C(m.offsetX,m.offsetY,0);d=u.group(),x=d.text(X(o/1e3)),x.font({fill:"#000",family:"Inconsolata",size:3}).move(F.x,F.y-10)}),v.mouseout(function(m){x.remove(),d.remove()}),S.push(v),v.stroke({color:"#aFF",width:.3,linecap:"round"}),v.animate(s,"now").during(function(m,F,M){var b=n+(_-n)*m,P=f+(g-f)*m;this.plot(n,f,b,P),Y==null&&(Y=u.group()),p==null&&(p=Y.image("/src/assets/point_end.png"),p.size(5,5)),p.mouseover(null),p.mouseout(null),p.move(b-2.5,P-5),p.mouseover(function(i){var r=C(i.offsetX,i.offsetY,0);d=u.group(),x=d.text(X(o/1e3)),x.font({fill:"#000",family:"Inconsolata",size:3}).move(r.x,r.y-10)}),p.mouseout(function(i){x.remove(),d.remove()})})}function xo(){p=null,E=null,T=null,Y=null,d=null,console.log(Y)}function bo(o,e,t,l,a,s){if(T==null&&(T=u.group()),Y==null&&(Y=u.group()),p==null&&(p=Y.image("/src/assets/point_end.png"),p.size(5,5)),p.mouseover(null),p.mouseout(null),p.move(e-2.5,t-5),p.mouseover(function(M){var b=C(M.offsetX,M.offsetY,0);d=u.group(),x=d.text(X(o/1e3)),x.font({fill:"#000",family:"Inconsolata",size:3}).move(b.x,b.y-10)}),p.mouseout(function(M){x.remove(),d.remove()}),S.length>s){for(var n=S.length-s,f=0;f<n;f++)S[s+f].remove();S.splice(s,n)}else{if(S.length==s)return;var _=e,g=t,v=l,m=a,F=u.line(_,g,v,m);F.mouseover(function(M){var b=C(M.offsetX,M.offsetY,0);d=u.group(),x=d.text(X(o/1e3)),x.font({fill:"#000",family:"Inconsolata",size:3}).move(b.x,b.y-10)}),F.mouseout(function(M){x.remove(),d.remove()}),S.push(F),F.stroke({color:"#aFF",width:.3,linecap:"round"})}}var Y,E,p;function yo(o,e,t){Y==null&&(Y=u.group()),console.log("花店"),E=Y.image("/src/assets/point_start.png"),E.move(e-2.5,t-5),E.size(5,5),E.mouseover(function(l){var a=C(l.offsetX,l.offsetY,0);d=u.group(),x=d.text(X(o/1e3)),x.font({fill:"#000",family:"Inconsolata",size:3}).move(a.x,a.y-10)}),E.mouseout(function(l){x.remove(),d.remove()})}function _o(o,e,t,l,a,s){z=u.group();var n=z.polygon(o);n.opacity(.3),n.fill("#0aa");var f=z.text(e);f.move(t-10,l-5).font({fill:"#000",family:"Inconsolata",size:2.5}),f.data("data",{name:e,id:s}),n.data("data",{name:e,id:s}),z.click(function(_){N.forEach((g,v)=>{g.fill("#0aa")}),a(n.data("data").id,n.data("data").name),n.fill("#a00")}),N.set(s,n)}function wo(o,e,t,l,a,s){z=u.group();var n=z.polygon(o);a==s?n.fill("#a00"):n.fill("#0aa"),n.opacity(.3);var f=z.text(e);f.move(t-10,l-5).font({fill:"#000",family:"Inconsolata",size:2.5})}function C(o,e,t){w("li.building-on");var l=0,a=0,s="",n="",f="",_=document.getElementById("svgPanel"),g=_.getAttribute("transform");if(g.indexOf(",")<0){var v=g.split(" ");g=v[0]+","+v[1]+" "+v[2]}return f=g.split(" "),s=f[0].substring(10,f[0].length-1).split(","),f.length==3?n=parseFloat(f[2].substring(6,f[2].length-1)):f.length==2&&(n=parseFloat(f[1].substring(6,f[1].length-1))),l=parseFloat(s[0]),a=parseFloat(s[1]),t==1?new V((o/n).toFixed(2),(e/n).toFixed(2)):new V(((o-l)/n).toFixed(2),((e-a)/n).toFixed(2))}function V(o,e){this.x=o,this.y=e}export{uo as a,yo as b,xo as c,ho as d,bo as e,go as f,mo as g,po as h,wo as i,_o as j,fo as l,q as m,co as r,vo as u};
