import{h as Q,w as k,ar as W,r as X,q as g,a8 as v,o as c,P as y,Q as d,a9 as S,k as Y,Z as h,V as b,z as t,m as C,l as Z,p as u,$ as H,a7 as J,t as ee,a0 as ae,a1 as oe}from"./vue-974988d6.js";import{a as te,c as le,_ as re}from"./index-1515df1a.js";import{b as V}from"./validate-8bf15b2e.js";import{F as G}from"./index-a773531e.js";import{l as P,a as F}from"./map-a5492c66.js";import{c as R,l as z,a as ne}from"./map_addfence-5401400f.js";import{n as B}from"./index-24a0fd9a.js";import{I as me}from"./gateway-d31fe4cf.js";import se from"./SGDrawer-93ebe6ea.js";import"./index-11ae6512.js";import"./index-7182f49c.js";import"./sass.default-e4c9116c.js";import"./moment-fbc5633a.js";const ie=_=>(ae("data-v-43f590cd"),_=_(),oe(),_),de={class:"title"},fe=ie(()=>C("div",{id:"main",class:"hdmrboxtm-mbox",viewBox:"0 0 0 0"},null,-1)),pe=Q({__name:"popupForm_back",emits:["get-change"],setup(_,{emit:N}){te();const w=k(),e=W("baTable"),{t:m}=le(),E=X({name:[V({name:"required",title:m("area_name")}),V({name:"varName"})],map_name:[V({name:"required",title:m("file")})]});function q(){if(R(),e.form.items.point="",e.form.items.gateway_mac="",l!=null&&l.length>0)for(var o=0;o<l.length;o++)l[o].show=!1}let l=[],f=k(!1);k("");const A=o=>{if(["Edit"].includes(e.form.operate)&&(R(),e.form.items.point="",e.form.items.gateway_mac="",l!=null&&l.length>0))for(var a=0;a<l.length;a++)l[a].show=!1;console.log(o),e.form.items.map_key=o.map_key,e.form.items.map_name=o.name,P(o.data),z(I,o.data),B(o.map_key).then(n=>{if(n.data.length>0)for(var r=0;r<n.data.length;r++){const s={address:n.data[r].address,name:n.data[r].name,x:n.data[r].x,y:n.data[r].y,proportion:o.proportion,show:!1};l[r]=s,F(l[r])}}).finally(()=>{})};function T(){console.log("onOpen"),["Edit"].includes(e.form.operate)&&e.form.items.point&&(P(e.form.items.data),z(I,e.form.items.data),B(e.form.items.map_key).then(o=>{if(o.data.length>0)for(var a=0;a<o.data.length;a++){const n={address:o.data[a].address,name:o.data[a].name,x:o.data[a].x,y:o.data[a].y,proportion:10,show:!1};l[a]=n,F(l[a])}}).finally(()=>{}),console.log(e.form.items),ne(e.form.items.point))}const U=o=>{console.log("关闭之前"),$("cancel")};function $(o){N("get-change",o)}function K(o){f.value=!1}function M(){return!(e.form.items.point!=null&&e.form.items.point.length>0)}function O(o){var a=5.5,n=0;for(let r=0;r<o.length;r++)a=a+o[r].x/1,n=n+o[r].y/1;return[a/o.length,n/o.length]}function I(o,a,n){console.log("回调划线="+a),e.form.items.data=n,e.form.items.point=o;for(var r="",s=0;s<l.length;s++){var x=me(l[s].x,l[s].y,a,l[s].proportion);x&&(l[s].show=!0,r=r+l[s].address+",")}var p=O(a);console.log("网关在   "+p[0]),e.form.items.x=p[0],e.form.items.y=p[1],e.form.items.gateway_mac=r,f.value=!0}return(o,a)=>{const n=g("el-form"),r=g("el-scrollbar"),s=g("el-button"),x=g("el-drawer"),p=v("drag"),j=v("zoom"),D=v("loading"),L=v("blur");return c(),y(x,{class:"ba-operate-dialog","close-on-click-modal":!0,"model-value":["Add","Edit"].includes(t(e).form.operate),"destroy-on-close":!0,title:t(m)("map.list.look"),direction:"rtl",size:"80%",opened:T(),"before-close":U},{header:d(()=>[S((c(),Y("div",de,[h(b(t(e).form.operate?t(m)(t(e).form.operate):""),1)])),[[p,[".ba-operate-dialog",".el-dialog__header"]],[j,".ba-operate-dialog"]])]),footer:d(()=>[C("div",{style:Z("width: calc(100% - "+t(e).form.labelWidth/1.8+"px)")},[u(s,{onClick:a[4]||(a[4]=i=>t(e).toggleForm(""))},{default:d(()=>[h(b(t(m)("Cancel")),1)]),_:1}),u(s,{type:"danger",onClick:q},{default:d(()=>[h(b(t(m)("clear")),1)]),_:1}),S((c(),y(s,{loading:t(e).form.submitLoading,disabled:M(),onClick:a[5]||(a[5]=i=>t(e).onSubmit(w.value)),type:"primary"},{default:d(()=>[h(b(t(e).form.operateIds&&t(e).form.operateIds.length>1?t(m)("Save and edit next item"):t(m)("Save")),1)]),_:1},8,["loading","disabled"])),[[L]])],4)]),default:d(()=>[S((c(),y(r,{class:"ba-table-form-scrollbar"},{default:d(()=>[C("div",null,[t(e).form.loading?J("",!0):(c(),y(n,{key:0,ref_key:"formRef",ref:w,onKeyup:a[2]||(a[2]=H(i=>t(e).onSubmit(w.value),["enter"])),model:t(e).form.items,rules:E},{default:d(()=>[u(G,{"input-attr":{clearable:!0},label:t(m)("area_name"),modelValue:t(e).form.items.name,"onUpdate:modelValue":a[0]||(a[0]=i=>t(e).form.items.name=i),type:"string",prop:"name",width:"60px",placeholder:t(m)("Please input field",{field:t(m)("area_name")})},null,8,["label","modelValue","placeholder"]),u(G,{prop:"map_name",label:t(m)("file"),type:"remoteSelect",modelValue:t(e).form.items.map_name,"onUpdate:modelValue":a[1]||(a[1]=i=>t(e).form.items.map_name=i),"input-attr":{multiple:!1,pk:"id",field:"name","remote-url":"/userApi/map/index2?aa="+Math.random(),onRow:A},placeholder:t(m)("file")},null,8,["label","modelValue","input-attr","placeholder"])]),_:1},8,["model","rules"]))]),fe,u(se,{show:t(f),"onUpdate:show":a[3]||(a[3]=i=>ee(f)?f.value=i:f=i),gateways:t(l),onGetChange:K},null,8,["show","gateways"])]),_:1})),[[D,t(e).form.loading]])]),_:1},8,["model-value","title","opened"])}}});const Ce=re(pe,[["__scopeId","data-v-43f590cd"]]);export{Ce as default};
